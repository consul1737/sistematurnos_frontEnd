"use strict";(self["webpackChunkpvn_fe"]=self["webpackChunkpvn_fe"]||[]).push([[511],{84511:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var o=function(){var t=this,e=t._self._c;return e("v-container",[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card-title",{attrs:{"card-title":"","primary-title":""}},[t._v("📅 Calendario de turnos")])],1),e("v-col",{staticClass:"d-flex flex-column align-center pa-6",attrs:{cols:"3"}},[e("v-btn",{staticClass:"ma-3",staticStyle:{width:"100%"},attrs:{color:"primary"},on:{click:t.handleCreateTurno}},[t._v("+ Nuevo Turno")]),e("v-divider"),e("v-row",{attrs:{justify:"center"}},[e("v-date-picker",{attrs:{"no-title":"","full-width":"","header-date-format":t.formatHeaderDate},model:{value:t.picker,callback:function(e){t.picker=e},expression:"picker"}})],1)],1),e("v-col",{attrs:{cols:"9"}},[e("section",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 50px"}},[e("div",{staticClass:"d-flex align-center"},[e("v-btn",{staticClass:"ma-1",attrs:{small:"",outlined:""},on:{click:t.prev}},[e("v-icon",[t._v("mdi-chevron-left")])],1),e("v-btn",{staticClass:"ma-1",attrs:{small:"",outlined:""},on:{click:t.next}},[e("v-icon",[t._v("mdi-chevron-right")])],1),t.$refs.calendar&&t.$refs.calendar.title?e("v-toolbar-title",[t._v(" "+t._s(t.$refs.calendar.title.toUpperCase())+" ")]):t._e()],1),e("v-btn-toggle",{staticClass:"d-flex",attrs:{outlined:""},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[e("v-btn",{attrs:{value:"month"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Mes")])]),e("v-btn",{attrs:{value:"week"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Semana")])]),e("v-btn",{attrs:{value:"day"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Diario")])]),e("v-btn",{attrs:{value:"list"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Lista")])])],1)],1),e("v-sheet",{staticClass:"pa-10",attrs:{height:"600"}},[e("v-container",{directives:[{name:"show",rawName:"v-show",value:"list"===t.type,expression:"type === 'list'"}]},[e("v-card",{staticClass:"mt-4"},[e("v-card-title",[t._v("Eventos del mes")]),e("v-list",[0===Object.keys(t.groupedEventsByDay).length?[e("v-list-item",[e("v-list-item-content",[e("v-alert",{staticClass:"mb-0",attrs:{type:"info",dense:""}},[t._v(" No hay eventos para este mes. ")])],1)],1)]:[e("transition-group",{attrs:{name:"list",tag:"div"}},[t._l(t.groupedEventsByDay,(function(a,o){return[e("v-list-item-group",{key:o,staticClass:"pa-2"},[e("v-subheader",{staticClass:"text-uppercase text-h6 font-weight-bold",staticStyle:{"background-color":"#c1c1c1",border:"1px solid #8e8e8e"},attrs:{color:"primary"}},[t._v(" "+t._s(new Intl.DateTimeFormat("es-ES",{weekday:"long",day:"numeric"}).format(new Date(o)))+" ")]),a.length>0?t._l(a,(function(a,n){return e("v-list-item",{key:`event-${o}-${n}`,staticStyle:{cursor:"pointer","border-bottom":"1px solid #8e8e8e"},on:{click:function(e){return t.showEvent({event:a})}}},[e("v-list-item-content",[e("v-list-item-title",{staticStyle:{"font-size":"0.8rem"}},[e("span",{style:{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:a.color,marginRight:"8px"}}),t._v(" "+t._s(new Date(a.start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))+" - "+t._s(a.name)+" ")])],1)],1)})):[e("v-list-item",[e("v-list-item-content",[e("v-alert",{staticClass:"mb-0",attrs:{type:"info",dense:""}},[t._v(" No hay actividades este día. ")])],1)],1)]],2)]}))],2)]],2)],1)],1),e("v-calendar",{directives:[{name:"show",rawName:"v-show",value:"list"!==t.type,expression:"type !== 'list'"}],ref:"calendar",attrs:{weekdays:t.weekday,type:"list"===t.type?"month":t.type,events:t.events,"event-overlap-threshold":30,"event-color":t.getEventColor,locale:"es"},on:{change:t.onCalendarChange,"click:event":t.showEvent},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1)],1),e("v-dialog",{attrs:{scrollable:"",overlay:!1,"max-width":"500px",transition:"dialog-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e("v-card",[e("v-toolbar",{attrs:{flat:"",height:"50px",tile:"",dark:"",color:"primary"}},[e("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){t.dialog=!1}}},[e("v-icon",[t._v("mdi-close")])],1),t.isEdit?e("v-btn",{attrs:{icon:"",dark:""},on:{click:t.eliminarTurno}},[e("v-icon",[t._v("mdi-delete")])],1):t._e(),e("v-toolbar-title",[t._v(t._s(t.isEdit?"Editar Turno":"Nuevo Turno"))])],1),e("v-card-text",{staticClass:"pa-4"},[e("v-autocomplete",{attrs:{label:"Paciente",items:t.pacientes,"item-text":t=>`${t.nombre} ${t.apellido}`,"item-value":"id_paciente",outlined:"",dense:"",required:""},model:{value:t.nuevoTurno.id_paciente,callback:function(e){t.$set(t.nuevoTurno,"id_paciente",e)},expression:"nuevoTurno.id_paciente"}}),e("v-select",{attrs:{label:"Consultorio",items:t.consultorios,"item-text":"nombre","item-value":"id_consultorio",outlined:"",dense:"",required:""},on:{change:t.cargarTratamientosPorConsultorio},scopedSlots:t._u([{key:"item",fn:function({item:a}){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:a.color||"#ccc",marginRight:"8px"}}),e("span",[t._v(t._s(a.nombre))])])]}}]),model:{value:t.nuevoTurno.id_consultorio,callback:function(e){t.$set(t.nuevoTurno,"id_consultorio",e)},expression:"nuevoTurno.id_consultorio"}}),e("v-select",{attrs:{label:"Tratamiento",items:t.tratamientosDisponibles,"item-text":"nombre_tratamiento","item-value":"id_tratamiento",outlined:"",dense:"",required:""},on:{change:t.actualizarDetallesTratamiento},scopedSlots:t._u([{key:"item",fn:function({item:a}){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:a.color,marginRight:"8px"}}),e("span",[t._v(t._s(a.nombre_tratamiento))])])]}}]),model:{value:t.nuevoTurno.id_tratamiento,callback:function(e){t.$set(t.nuevoTurno,"id_tratamiento",e)},expression:"nuevoTurno.id_tratamiento"}}),e("v-menu",{ref:"menuFecha",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:o}){return[e("v-text-field",t._g(t._b({attrs:{label:"Fecha","prepend-icon":"mdi-calendar",readonly:"",outlined:"",dense:"",required:""},model:{value:t.nuevoTurno.fecha,callback:function(e){t.$set(t.nuevoTurno,"fecha",e)},expression:"nuevoTurno.fecha"}},"v-text-field",o,!1),a))]}}]),model:{value:t.menuFecha,callback:function(e){t.menuFecha=e},expression:"menuFecha"}},[e("v-date-picker",{attrs:{"no-title":"",locale:"es","header-date-format":t.formatHeaderDate},on:{input:function(e){t.menuFecha=!1}},model:{value:t.nuevoTurno.fecha,callback:function(e){t.$set(t.nuevoTurno,"fecha",e)},expression:"nuevoTurno.fecha"}})],1),e("v-menu",{ref:"menuHora",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:o}){return[e("v-text-field",t._g(t._b({attrs:{label:"Seleccionar hora","prepend-icon":"mdi-clock-time-four-outline",suffix:"HH:MM",outlined:"",dense:"",required:""},model:{value:t.horaFormateada,callback:function(e){t.horaFormateada=e},expression:"horaFormateada"}},"v-text-field",o,!1),a))]}}]),model:{value:t.menuHora,callback:function(e){t.menuHora=e},expression:"menuHora"}},[e("v-time-picker",{attrs:{format:"24hr"},on:{input:function(e){t.menuHora=!1}},model:{value:t.nuevoTurno.hora,callback:function(e){t.$set(t.nuevoTurno,"hora",e)},expression:"nuevoTurno.hora"}})],1),e("v-text-field",{attrs:{label:"Duración del Tratamiento",outlined:"",dense:"",readonly:"",suffix:"minutos"},model:{value:t.tratamientoSeleccionado.duracion,callback:function(e){t.$set(t.tratamientoSeleccionado,"duracion",e)},expression:"tratamientoSeleccionado.duracion"}}),e("v-text-field",{attrs:{label:"Costo del Tratamiento",prefix:"$",outlined:"",dense:"",readonly:""},model:{value:t.tratamientoSeleccionado.costo,callback:function(e){t.$set(t.tratamientoSeleccionado,"costo",e)},expression:"tratamientoSeleccionado.costo"}})],1),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{color:"success"},on:{click:t.guardarTurno}},[t._v(" "+t._s(t.isEdit?"Guardar Cambios":"Guardar Turno")+" ")])],1)],1)],1)],1)},n=[],r=(a(44114),a(98992),a(72577),a(3949),a(81454),a(8872),a(94373)),i={data:()=>({turnos:[],type:"day",types:[{text:"Mes",value:"month"},{text:"Semana",value:"week"},{text:"Día",value:"day"},{text:"Lista",value:"list"}],weekday:[0,1,2,3,4,5,6],value:"",currentMonth:null,currentYear:null,picker:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),events:[],dialog:!1,isEdit:!1,pacientes:[],consultorios:[],tratamientosDisponibles:[],tratamientoSeleccionado:{duracion:null,costo:null},nuevoTurno:{id_paciente:null,fecha:"",hora:"",estado:"pendiente",id_consultorio:null,id_tratamiento:null},menuFecha:!1,menuFechaFiltro:!1,filtroFecha:"",menuHora:!1}),methods:{formatHeaderDate(t){if("string"===typeof t&&t.match(/^\d{4}-\d{2}$/)){const[e,a]=t.split("-");t=new Date(parseInt(e,10),parseInt(a,10)-1,1)}if(!t||!(t instanceof Date)||isNaN(t))return"FECHA INVÁLIDA";const e=new Intl.DateTimeFormat("es",{month:"long"}).format(t),a=t.getFullYear();return`${e.toUpperCase()} ${a}`},async cargarTurnos(){try{const t=await r.A.get("/turnos/calendario");this.turnos=t.data,this.$nextTick((()=>{this.getEvents()}))}catch(t){console.error("Error al cargar turnos:",t)}},getEvents(){this.events=[];const t=this.turnos.map((t=>{const e=new Date(`${t.fecha}T${t.hora}`),a=t.duracion_tratamiento,o=new Date(e.getTime()+6e4*a);return{id_turno:t.id_turno,id_paciente:t.id_paciente,id_consultorio:t.id_consultorio,id_tratamiento:t.id_tratamiento,name:`${t.nombre_paciente} ${t.apellido_paciente}`,start:e,end:o,color:t.color_tratamiento,timed:!0}}));t.sort(((t,e)=>t.start-e.start)),this.events=t},onCalendarChange({start:t}){const e=new Date(t.date);this.currentMonth=e.getUTCMonth(),this.currentYear=e.getUTCFullYear(),this.$forceUpdate()},prev(){this.$refs.calendar&&this.$refs.calendar.prev()},next(){this.$refs.calendar&&this.$refs.calendar.next()},getEventColor(t){return t.color},handleCreateTurno(){this.isEdit=!1,this.dialog=!0},showEvent({event:t}){this.dialog=!0,this.isEdit=!0;const e={...t};this.nuevoTurno={id_turno:e.id_turno,id_paciente:e.id_paciente,fecha:e.start?this.formatDate(e.start):null,hora:e.start?this.formatTime(e.start):null,estado:e.estado||"pendiente",id_consultorio:e.id_consultorio,id_tratamiento:e.id_tratamiento},e.id_consultorio&&this.cargarTratamientosPorConsultorio(e.id_consultorio),e.id_tratamiento&&this.actualizarDetallesTratamiento(e.id_tratamiento)},formatDate(t){const e=new Date(t);return e.toISOString().split("T")[0]},formatTime(t){const e=new Date(t),a=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${a}:${o}`},async cargarPacientes(){try{const t=await r.A.get("/pacientes");this.pacientes=t.data}catch(t){console.error("Error al cargar pacientes:",t)}},async fetchConsultoriosyTratamientos(){try{const t=await r.A.get("/consultorios/tratamientos");this.consultorios=t.data.map((t=>({id_consultorio:t.id_consultorio,nombre:t.nombre_consultorio,tratamiento:t.id_tratamiento?[{id_tratamiento:t.id_tratamiento,nombre:t.nombre_tratamiento,descripcion:t.descripcion_tratamiento,costo:t.costo_tratamiento,duracion:t.duracion_tratamiento,color:t.color_tratamiento}]:[],displayText:`${t.nombre_consultorio} -  ${t.id_tratamiento?t.nombre_tratamiento:"Sin tratamiento"}`}))).sort(((t,e)=>t.id_consultorio-e.id_consultorio))}catch(t){console.error("Error fetching consultorios and tratamientos:",t)}},async cargarTratamientosPorConsultorio(t){try{const e=await r.A.get(`/tratamientos/tratamientosconsul/${t}`);this.tratamientosDisponibles=e.data||[],this.isEdit&&this.nuevoTurno.id_tratamiento?this.actualizarDetallesTratamiento(this.nuevoTurno.id_tratamiento):(this.nuevoTurno.id_tratamiento=null,this.tratamientoSeleccionado={duracion:null,costo:null})}catch(e){console.error("Error al cargar tratamientos:",e.message),this.tratamientosDisponibles=[]}},actualizarDetallesTratamiento(t){const e=this.tratamientosDisponibles.find((e=>e.id_tratamiento===t));this.tratamientoSeleccionado=e?{duracion:e.duracion,costo:e.costo}:{duracion:null,costo:null}},guardarTurno(){this.isEdit?this.updateTurno(this.nuevoTurno):this.createTurno(this.nuevoTurno)},async createTurno(t){try{await r.A.post("/turnos",t);this.cargarTurnos(),this.dialog=!1}catch(e){const t=e.response?.data?.message||"Error al crear el turno.";this.$toast.error(t)}},async updateTurno(t){try{await r.A.put(`/turnos/${t.id_turno}`,t);this.cargarTurnos(),this.dialog=!1}catch(e){console.error("Error al actualizar el turno:",e);const t=e.response?.data?.message||"Error al actualizar el turno.";this.$toast.error(t)}},eliminarTurno(){this.nuevoTurno.id_turno&&r.A.delete(`/turnos/${this.nuevoTurno.id_turno}`).then((()=>{this.cargarTurnos(),this.dialog=!1})).catch((t=>{console.error("Error al eliminar el turno:",t),this.$toast.error("Error al eliminar el turno.")}))}},mounted(){this.cargarTurnos(),this.cargarPacientes(),this.fetchConsultoriosyTratamientos(),this.$nextTick((()=>{if(this.$refs.calendar){this.value=this.$refs.calendar.value;const t=new Date(this.value);this.currentMonth=t.getUTCMonth(),this.currentYear=t.getUTCFullYear(),this.$forceUpdate()}}))},watch:{dialog(t){t||(this.nuevoTurno={id_paciente:null,fecha:"",hora:"",estado:"pendiente",id_consultorio_tratamiento:null})}},computed:{groupedEventsByDay(){if(null===this.currentMonth||null===this.currentYear)return{};const t=this.events.reduce(((t,e)=>{const a=new Date(e.start),o=a.getUTCMonth(),n=a.getUTCFullYear();if(o===this.currentMonth&&n===this.currentYear){const r=`${n}-${(o+1).toString().padStart(2,"0")}-${a.getUTCDate().toString().padStart(2,"0")}`;t[r]||(t[r]=[]),t[r].push(e)}return t}),{}),e={};return Object.keys(t).sort(((t,e)=>new Date(t)-new Date(e))).forEach((a=>{e[a]=t[a]})),e},horaFormateada(){return this.nuevoTurno.hora?this.nuevoTurno.hora:""},validarDatosTurno(){return!!this.nuevoTurno.id_paciente&&!!this.nuevoTurno.id_consultorio&&!!this.nuevoTurno.id_tratamiento&&!!this.nuevoTurno.fecha&&!!this.nuevoTurno.hora&&""!==this.nuevoTurno.fecha.trim()&&""!==this.nuevoTurno.hora.trim()}}},s=i,l=a(81656),c=(0,l.A)(s,o,n,!1,null,null,null),u=c.exports}}]);
//# sourceMappingURL=511.50bd399b.js.map