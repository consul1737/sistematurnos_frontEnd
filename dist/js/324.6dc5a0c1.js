"use strict";(self["webpackChunkpvn_fe"]=self["webpackChunkpvn_fe"]||[]).push([[324],{30324:function(t,e,a){a.r(e),a.d(e,{default:function(){return u}});var o=function(){var t=this,e=t._self._c;return e("v-container",{staticStyle:{position:"relative"},attrs:{fluid:""}},[e("v-row",{staticClass:"fill-height ma-0 px-12"},[e("v-col",{staticClass:"ma-0 d-flex align-lg-center justify-space-between",staticStyle:{border:"#8e8e8e 0.3px solid","border-radius":"0.2rem",height:"50px"},attrs:{cols:"12"}},[e("v-card-title",{staticClass:"text-h5",attrs:{cols:"9","card-title":"","primary-title":""}},[t._v("📅 Calendario de turnos")]),e("div",{staticClass:"d-flex align-center",attrs:{cols:"3"}},[e("v-col",{staticClass:"d-flex flex-column align-center pa-6"},[e("v-btn",{staticClass:"ma-3",staticStyle:{width:"100%"},attrs:{color:"primary"},on:{click:t.handleCreateTurno}},[t._v("+ Nuevo Turno")])],1),e("v-col",{staticClass:"d-flex flex-column align-center pa-6"},[e("v-btn",{staticClass:"ma-3",attrs:{icon:""},on:{click:function(e){t.configCob=!t.configCob}}},[e("v-icon",[t._v("mdi-cog-outline")])],1)],1)],1)],1),e("v-col",{staticClass:"ma-0 d-flex align-lg-center justify-space-between",staticStyle:{position:"relative",border:"#8e8e8e 0.3px solid","border-radius":"0.2rem",height:"70px"},attrs:{cols:"12"}},[e("v-col",{attrs:{cols:"5"}},[e("div",{staticClass:"d-flex align-center"},[e("v-btn",{staticClass:"ma-1",attrs:{height:"20px",small:"",outlined:""},on:{click:t.prev}},[e("v-icon",[t._v("mdi-chevron-left")])],1),e("v-btn",{staticClass:"ma-2",attrs:{height:"20px",small:"",outlined:""},on:{click:t.next}},[e("v-icon",[t._v("mdi-chevron-right")])],1),t.$refs.calendar&&t.$refs.calendar.title?e("v-toolbar-title",{staticClass:"text-capitalize text-subtitle-1"},[t._v(" "+t._s(t.$refs.calendar.title.toUpperCase())+" ")]):t._e()],1)]),e("section",{staticStyle:{display:"flex","justify-content":"space-between",margin:"10px 50px"}},[e("v-btn-toggle",{staticClass:"d-flex",attrs:{outlined:""},model:{value:t.type,callback:function(e){t.type=e},expression:"type"}},[e("v-btn",{staticClass:"text-capitalize text-subtitle-2",attrs:{value:"month",height:"35px"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Mes")])]),e("v-btn",{staticClass:"text-capitalize text-subtitle-2",attrs:{value:"week",height:"35px"},on:{click:t.setToCurrentDate}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Semana")])]),e("v-btn",{staticClass:"text-capitalize text-subtitle-2",attrs:{value:"day",height:"35px"},on:{click:t.setToCurrentDate}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Diario")])]),e("v-btn",{staticClass:"text-capitalize text-subtitle-2",attrs:{value:"list",height:"35px"}},[e("span",{staticClass:"hidden-sm-and-down"},[t._v("Agenda")])])],1)],1)],1),e("v-col",{staticClass:"pa-0 border-b-lg",staticStyle:{border:"#8e8e8e 0.3px solid","border-radius":"0.2rem"},attrs:{cols:"12"}},[e("v-sheet",{attrs:{height:"fill-height",width:"99.9%"}},[e("v-container",{directives:[{name:"show",rawName:"v-show",value:"list"===t.type,expression:"type === 'list'"}]},[e("v-card",{staticClass:"mt-4"},[e("v-card-title",[t._v("Eventos del mes")]),e("v-list",{staticClass:"overflow-y-auto",staticStyle:{"max-height":"400px"}},[0===Object.keys(t.groupedEventsByDay).length?[e("v-list-item",[e("v-list-item-content",[e("v-alert",{staticClass:"mb-0",attrs:{type:"info",dense:""}},[t._v(" No hay eventos para este mes. ")])],1)],1)]:[e("transition-group",{attrs:{name:"list",tag:"div"}},[t._l(t.groupedEventsByDay,(function(a,o){return[e("v-list-item-group",{key:o,staticClass:"pa-2"},[e("v-subheader",{staticClass:"text-uppercase text-h6 font-weight-bold",staticStyle:{"background-color":"#c1c1c1",border:"1px solid #8e8e8e"},attrs:{color:"primary"}},[t._v(" "+t._s(new Intl.DateTimeFormat("es-ES",{weekday:"long",day:"numeric",timeZone:"UTC"}).format(new Date(o+"T00:00:00Z")))+" ")]),a.length>0?t._l(a,(function(a,i){return e("v-list-item",{key:`event-${o}-${i}`,staticStyle:{cursor:"pointer","border-bottom":"1px solid #8e8e8e"},on:{click:function(e){return t.showEvent({event:a})}}},[e("v-list-item-content",[e("v-list-item-title",{staticStyle:{"font-size":"0.8rem"}},[e("span",{style:{display:"inline-block",width:"10px",height:"10px",borderRadius:"50%",backgroundColor:a.color,marginRight:"8px"}}),e("span",{staticClass:"font-weight-bold",staticStyle:{"font-size":"1rem"}},[t._v(" "+t._s(new Date(a.start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))+" ")]),e("span",{staticClass:"font-weight-bold"},[t._v(" "+t._s(a.category)+" ")]),t._v("- "),e("span",{staticClass:"font-weight-bold",style:{color:a.color}},[t._v(" "+t._s(a.nombre_tratamiento)+" ")]),t._v(" - "+t._s(a.name)+" "+t._s(a.apellido_paciente)+" ")])],1)],1)})):[e("v-list-item",[e("v-list-item-content",[e("v-alert",{staticClass:"mb-0",attrs:{type:"info",dense:""}},[t._v(" No hay actividades este día. ")])],1)],1)]],2)]}))],2)]],2)],1)],1),e("v-calendar",{directives:[{name:"show",rawName:"v-show",value:"list"!==t.type,expression:"type !== 'list'"}],ref:"calendar",attrs:{weekdays:t.weekday,type:t.calendarType,events:t.events,"event-overlap-mode":"column","event-overlap-threshold":60,"event-color":t.getEventColor,categories:t.categories,"interval-height":60,"interval-count":t.intervalCount,"interval-minutes":t.intervalMinutes,"first-time":"07:00",locale:"es"},on:{change:t.onCalendarChange,"click:event":t.showEvent,"click:more":t.handleClickMore},scopedSlots:t._u([{key:"event",fn:function({event:a}){return[e("v-tooltip",{style:{"--tooltip-border-color":a.color,"--tooltip-bg-color":a.colorLigth},attrs:{top:"","content-class":"custom-tooltip","open-delay":"150"},scopedSlots:t._u([{key:"activator",fn:function({on:o,attrs:i}){return["week"===t.calendarType?e("div",t._g(t._b({staticClass:"text-center",style:{backgroundColor:a.colorLigth,color:a.colorDark}},"div",i,!1),o),[e("strong",[t._v(t._s(a.category))]),e("br"),e("strong",[t._v(t._s(a.name))])]):e("div",t._g(t._b({staticClass:"text-center",style:{color:a.colorDark}},"div",i,!1),o),[e("span",{staticClass:"font-weight-bold"},[t._v(t._s(new Date(a.start).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))+" "+t._s(a.name)+" "+t._s(a.apellido_paciente))]),e("br"),e("strong",[t._v(t._s(a.nombre_tratamiento))])])]}}],null,!0)},[e("v-card",{style:{border:`2px solid ${a.color}`},attrs:{color:a.colorLigth,elevation:"0"}},[e("v-card-text",{staticClass:"text-lg-subtitle-1",style:{color:a.colorDark}},[e("div",[e("strong",[t._v("Consultorio:")]),t._v(" "+t._s(a.category)+" ")]),e("div",[e("strong",[t._v("Tratamiento:")]),t._v(" "+t._s(a.nombre_tratamiento)+" ")]),e("div",[e("strong",[t._v("Hora:")]),t._v(" "+t._s(t.formatTime(a.start))+" - "+t._s(t.formatTime(a.end))+" ")]),e("div",[e("strong",[t._v("Duración: ")]),t._v(" "+t._s(a.duracion_tratamiento)+" min ")]),e("div",[e("strong",[t._v("Nombre:")]),t._v(" "+t._s(a.name))]),e("div",[e("strong",[t._v("Apellido:")]),t._v(" "+t._s(a.apellido_paciente)+" ")])])],1)],1)]}}]),model:{value:t.value,callback:function(e){t.value=e},expression:"value"}})],1)],1)],1),e("v-dialog",{attrs:{scrollable:"",overlay:!1,"max-width":"500px",transition:"dialog-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[e("v-card",[e("v-toolbar",{attrs:{flat:"",height:"50px",tile:"",dark:"",color:"primary"}},[e("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){t.dialog=!1}}},[e("v-icon",[t._v("mdi-close")])],1),t.isEdit?e("v-btn",{attrs:{icon:"",dark:""},on:{click:t.handleEliminarTurno}},[e("v-icon",[t._v("mdi-delete")])],1):t._e(),e("v-toolbar-title",[t._v(t._s(t.isEdit?"Editar Turno":"Nuevo Turno"))])],1),e("v-card-text",{staticClass:"pa-4"},[e("v-autocomplete",{attrs:{label:"Paciente",items:t.pacientes,"item-text":t=>`${t.nombre} ${t.apellido}`,"item-value":"id_paciente",outlined:"",dense:"",required:""},model:{value:t.nuevoTurno.id_paciente,callback:function(e){t.$set(t.nuevoTurno,"id_paciente",e)},expression:"nuevoTurno.id_paciente"}}),e("v-select",{attrs:{label:"Consultorio",items:t.consultorios,"item-text":"nombre","item-value":"id_consultorio",outlined:"",dense:"",required:""},on:{change:t.cargarTratamientosPorConsultorio},scopedSlots:t._u([{key:"item",fn:function({item:a}){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:a.color||"#ccc",marginRight:"8px"}}),e("span",[t._v(t._s(a.nombre))])])]}}]),model:{value:t.nuevoTurno.id_consultorio,callback:function(e){t.$set(t.nuevoTurno,"id_consultorio",e)},expression:"nuevoTurno.id_consultorio"}}),e("v-select",{attrs:{label:"Tratamiento",items:t.tratamientosDisponibles,"item-text":"nombre_tratamiento","item-value":"id_tratamiento",outlined:"",dense:"",required:""},on:{change:t.actualizarDetallesTratamiento},scopedSlots:t._u([{key:"item",fn:function({item:a}){return[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("div",{style:{width:"12px",height:"12px",borderRadius:"50%",backgroundColor:a.color,marginRight:"8px"}}),e("span",[t._v(t._s(a.nombre_tratamiento))])])]}}]),model:{value:t.nuevoTurno.id_tratamiento,callback:function(e){t.$set(t.nuevoTurno,"id_tratamiento",e)},expression:"nuevoTurno.id_tratamiento"}}),e("v-menu",{ref:"menuFecha",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:o}){return[e("v-text-field",t._g(t._b({attrs:{label:"Fecha","prepend-icon":"mdi-calendar",readonly:"",outlined:"",dense:"",required:""},model:{value:t.nuevoTurno.fecha,callback:function(e){t.$set(t.nuevoTurno,"fecha",e)},expression:"nuevoTurno.fecha"}},"v-text-field",o,!1),a))]}}]),model:{value:t.menuFecha,callback:function(e){t.menuFecha=e},expression:"menuFecha"}},[e("v-date-picker",{attrs:{"no-title":"",locale:"es","header-date-format":t.formatHeaderDate},on:{input:function(e){t.menuFecha=!1}},model:{value:t.nuevoTurno.fecha,callback:function(e){t.$set(t.nuevoTurno,"fecha",e)},expression:"nuevoTurno.fecha"}})],1),e("v-menu",{ref:"menuHora",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:t._u([{key:"activator",fn:function({on:a,attrs:o}){return[e("v-text-field",t._g(t._b({attrs:{label:"Seleccionar hora","prepend-icon":"mdi-clock-time-four-outline",suffix:"HH:MM",outlined:"",dense:"",required:""},model:{value:t.horaFormateada,callback:function(e){t.horaFormateada=e},expression:"horaFormateada"}},"v-text-field",o,!1),a))]}}]),model:{value:t.menuHora,callback:function(e){t.menuHora=e},expression:"menuHora"}},[e("v-time-picker",{attrs:{format:"24hr"},on:{input:function(e){t.menuHora=!1}},model:{value:t.nuevoTurno.hora,callback:function(e){t.$set(t.nuevoTurno,"hora",e)},expression:"nuevoTurno.hora"}})],1),e("v-text-field",{attrs:{label:"Duración del Tratamiento",outlined:"",dense:"",readonly:"",suffix:"minutos"},model:{value:t.tratamientoSeleccionado.duracion,callback:function(e){t.$set(t.tratamientoSeleccionado,"duracion",e)},expression:"tratamientoSeleccionado.duracion"}}),e("v-text-field",{attrs:{label:"Costo del Tratamiento",prefix:"$",outlined:"",dense:"",readonly:""},model:{value:t.tratamientoSeleccionado.costo,callback:function(e){t.$set(t.tratamientoSeleccionado,"costo",e)},expression:"tratamientoSeleccionado.costo"}})],1),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{color:"success"},on:{click:t.guardarTurno}},[t._v(" "+t._s(t.isEdit?"Guardar Cambios":"Guardar Turno")+" ")])],1)],1)],1),e("v-dialog",{attrs:{"max-width":"600"},model:{value:t.dialogDia,callback:function(e){t.dialogDia=e},expression:"dialogDia"}},[e("v-card",[e("v-card-title",[t._v(" Turnos del día: "+t._s(t.selectedDate)+" ")]),e("v-card-text",[e("v-list",t._l(t.eventsOfDay,(function(a,o){return e("v-list-item",{key:o},[e("v-list-item-content",[e("v-list-item-title",[t._v(" "+t._s(a.nombre_paciente)+" "+t._s(a.apellido_paciente)+" ")]),e("v-list-item-subtitle",[e("strong",[t._v("Tratamiento:")]),t._v(" "+t._s(a.nombre_tratamiento)+" ")]),e("v-list-item-subtitle",[e("strong",[t._v("Hora:")]),t._v(" "+t._s(t.formatTime(a.start))+" - "+t._s(t.formatTime(a.end))+" ")]),e("v-list-item-subtitle",[e("strong",[t._v("Consultorio:")]),t._v(" "+t._s(a.nombre_consultorio||"Sin consultorio")+" ")])],1),e("v-list-item-action",[e("v-chip",{style:{color:a.colorDark},attrs:{color:a.colorLigth,dark:"",small:""}},[t._v(" "+t._s(a.nombre_tratamiento)+" ")])],1)],1)})),1)],1),e("v-card-actions",[e("v-btn",{attrs:{color:"primary"},on:{click:function(e){t.dialogDia=!1}}},[t._v("Cerrar")])],1)],1)],1),e("v-dialog",{attrs:{"max-width":"600"},model:{value:t.elimiarTurno,callback:function(e){t.elimiarTurno=e},expression:"elimiarTurno"}},[e("v-card",[e("v-toolbar",{attrs:{flat:"",height:"50px",tile:"",dark:"",color:"red"}},[e("v-toolbar-title",[t._v(" Eliminar Turno ")])],1),e("v-card-text",{staticClass:"text-h6 font-weight-bold my-2"},[t._v(" ¿Estás seguro de que deseas eliminar este turno? ")]),e("v-card-actions",[e("v-spacer"),e("v-btn",{attrs:{color:"red",text:""},on:{click:function(e){t.elimiarTurno=!1}}},[t._v("Cancelar")]),e("v-btn",{attrs:{color:"green",text:""},on:{click:t.eliminarTurno}},[t._v("Aceptar")])],1)],1)],1),e("v-navigation-drawer",{attrs:{"hide-overlay":!0,right:"",absolute:"",temporary:"",width:"350"},model:{value:t.configCob,callback:function(e){t.configCob=e},expression:"configCob"}},[e("v-toolbar",{attrs:{flat:"",height:"50px",tile:"",dark:"",color:"primary"}},[e("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){t.configCob=!1}}},[e("v-icon",[t._v("mdi-close")])],1),e("v-toolbar-title",[t._v("Configura la vista")])],1),e("div",{staticClass:"pa-4"},[e("div",{staticClass:"font-weight-bold my-4"},[t._v("Dias de la semana a mostrar")]),e("v-select",{attrs:{items:t.weekdays,dense:"",outlined:"","hide-details":""},model:{value:t.weekday,callback:function(e){t.weekday=e},expression:"weekday"}}),e("hr",{staticClass:"my-4",staticStyle:{"border-color":"#ccc",width:"100%"}}),e("div",{staticClass:"font-weight-bold my-4"},[t._v("Intervalos de hora")]),e("v-slider",{attrs:{min:15,max:60,step:15,label:"Cada x minutos","thumb-label":"always"},model:{value:t.intervalMinutes,callback:function(e){t.intervalMinutes=e},expression:"intervalMinutes"}})],1)],1)],1)},i=[],r=(a(44114),a(98992),a(54520),a(72577),a(3949),a(81454),a(8872),a(37550),a(94373)),n={data:()=>({turnos:[],intervalMinutes:parseInt(localStorage.getItem("intervalMinutes"))||30,type:localStorage.getItem("defaultView")||"day",today:(new Date).toISOString().slice(0,10),types:[{text:"Mes",value:"month"},{text:"Semana",value:"week"},{text:"Día",value:"day"},{text:"Lista",value:"list"}],weekday:localStorage.getItem("weekday")||[1,2,3,4,5,6,0],weekdays:[{text:"Lun - Vie",value:[1,2,3,4,5]},{text:"Lun - Sab",value:[1,2,3,4,5,6]},{text:"Lun - Dom",value:[1,2,3,4,5,6,0]}],value:localStorage.getItem("selectedDate")||(new Date).toISOString().split("T")[0],currentMonth:null,currentYear:null,picker:new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString().substr(0,10),events:[],dialog:!1,dialogDia:!1,elimiarTurno:!1,configCob:!1,isEdit:!1,pacientes:[],consultorios:[],tratamientosDisponibles:[],tratamientoSeleccionado:{duracion:null,costo:null},nuevoTurno:{id_paciente:null,fecha:"",hora:"",estado:"pendiente",id_consultorio:null,id_tratamiento:null},menuFecha:!1,menuFechaFiltro:!1,filtroFecha:"",menuHora:!1,categories:[],selectedDate:null,eventsOfDay:[]}),methods:{handleConfigCob(){this.configCob=!0},handleEliminarTurno(){this.elimiarTurno=!0},handleClickMore({date:t}){const e=new Date(t);this.eventsOfDay=this.events.filter((t=>{const a=t.start.toISOString().split("T")[0],o=e.toISOString().split("T")[0];return a===o})),this.selectedDate=e.toLocaleDateString(),this.dialogDia=!0},formatTime(t){return t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})},setToCurrentDate(){this.value=(new Date).toISOString().split("T")[0],this.updateCategories(),this.getEvents()},updateCategories(){const t=this.value;console.log("consultorios:",this.consultorios);const e=this.consultorios.filter((e=>this.events.some((a=>{const o=new Date(a.start).toISOString().split("T")[0];return o===t&&a.category===e.nombre}))));this.categories=e.map((t=>t.nombre)),console.log("Categorías actualizadas:",this.categories)},formatHeaderDate(t){if("string"===typeof t&&t.match(/^\d{4}-\d{2}$/)){const[e,a]=t.split("-");t=new Date(parseInt(e,10),parseInt(a,10)-1,1)}if(!t||!(t instanceof Date)||isNaN(t))return"FECHA INVÁLIDA";const e=new Intl.DateTimeFormat("es",{month:"long"}).format(t),a=t.getFullYear();return`${e.toUpperCase()} ${a}`},async cargarTurnos(){try{const t=await r.A.get("/turnos/calendario");this.turnos=t.data}catch(t){console.error("Error al cargar turnos:",t)}},getEvents(){this.events=[],console.log("Turnos:",this.turnos);const t=this.turnos.map((t=>{const e=new Date(`${t.fecha}T${t.hora}`),a=t.duracion_tratamiento,o=new Date(e.getTime()+6e4*a),i=this.isValidHexColor(t.color_tratamiento)?this.darkenColor(t.color_tratamiento,.6):null,r=this.isValidHexColor(t.color_tratamiento)?this.lightenColor(t.color_tratamiento,.4):null;console.log("turno.color_tratamiento:",t.color_tratamiento),console.log("colorDark:",i);const n=t.nombre_consultorio||"Sin consultorio";return{id_turno:t.id_turno,id_paciente:t.id_paciente,id_consultorio:t.id_consultorio,id_tratamiento:t.id_tratamiento,nombre_tratamiento:t.nombre_tratamiento,name:t.nombre_paciente,apellido_paciente:t.apellido_paciente,duracion_tratamiento:a,start:e,end:o,color:t.color_tratamiento,colorDark:i,colorLigth:r,timed:!0,category:n}}));t.sort(((t,e)=>t.start-e.start)),this.events=t},darkenColor(t,e=.2){if(!this.isValidHexColor(t))return console.warn("Color no válido:",t),t;t=t.replace("#",""),8===t.length&&(t=t.substring(0,6));const a=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),r=Math.floor(a*(1-e)),n=Math.floor(o*(1-e)),s=Math.floor(i*(1-e)),l=t=>t.toString(16).padStart(2,"0");return`#${l(r)}${l(n)}${l(s)}`},lightenColor(t,e=.2){if(!this.isValidHexColor(t))return console.warn("Color no válido:",t),t;t=t.replace("#",""),8===t.length&&(t=t.substring(0,6));const a=parseInt(t.substring(0,2),16),o=parseInt(t.substring(2,4),16),i=parseInt(t.substring(4,6),16),r=Math.min(255,a+Math.floor((255-a)*e)),n=Math.min(255,o+Math.floor((255-o)*e)),s=Math.min(255,i+Math.floor((255-i)*e)),l=t=>t.toString(16).padStart(2,"0");return`#${l(r)}${l(n)}${l(s)}`},isValidHexColor(t){return/^#([A-Fa-f0-9]{6}([A-Fa-f0-9]{2})?|[A-Fa-f0-9]{3})$/.test(t)},onCalendarChange({start:t}){const e=new Date(t.date);this.currentMonth=e.getUTCMonth(),this.currentYear=e.getUTCFullYear(),this.value=t.date,this.updateCategories(),this.getEvents()},prev(){this.$refs.calendar&&(this.$refs.calendar.prev(),this.$refs.calendar.update(),this.updateValue())},next(){this.$refs.calendar&&(this.$refs.calendar.next(),this.$refs.calendar.update(),this.updateValue())},getEventColor(t){return t.colorLigth},handleCreateTurno(){this.isEdit=!1,this.dialog=!0},showEvent({event:t}){this.dialog=!0,this.isEdit=!0;const e={...t};this.nuevoTurno={id_turno:e.id_turno,id_paciente:e.id_paciente,fecha:e.start?this.formatDate(e.start):null,hora:e.start?this.formatTime(e.start):null,estado:e.estado||"pendiente",id_consultorio:e.id_consultorio,id_tratamiento:e.id_tratamiento},e.id_consultorio&&this.cargarTratamientosPorConsultorio(e.id_consultorio),e.id_tratamiento&&this.actualizarDetallesTratamiento(e.id_tratamiento)},formatDate(t){const e=new Date(t);return e.toISOString().split("T")[0]},formatTime(t){const e=new Date(t),a=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0");return`${a}:${o}`},async cargarPacientes(){try{const t=await r.A.get("/pacientes");this.pacientes=t.data}catch(t){console.error("Error al cargar pacientes:",t)}},async fetchConsultoriosyTratamientos(){try{const t=await r.A.get("/consultorios/tratamientos");this.consultorios=t.data.map((t=>({id_consultorio:t.id_consultorio,nombre:t.nombre_consultorio,tratamiento:t.id_tratamiento?[{id_tratamiento:t.id_tratamiento,nombre:t.nombre_tratamiento,descripcion:t.descripcion_tratamiento,costo:t.costo_tratamiento,duracion:t.duracion_tratamiento,color:t.color_tratamiento}]:[],displayText:`${t.nombre_consultorio} -  ${t.id_tratamiento?t.nombre_tratamiento:"Sin tratamiento"}`}))).sort(((t,e)=>t.id_consultorio-e.id_consultorio))}catch(t){console.error("Error fetching consultorios and tratamientos:",t)}},async cargarTratamientosPorConsultorio(t){try{const e=await r.A.get(`/tratamientos/tratamientosconsul/${t}`);this.tratamientosDisponibles=e.data||[],this.isEdit&&this.nuevoTurno.id_tratamiento?this.actualizarDetallesTratamiento(this.nuevoTurno.id_tratamiento):(this.nuevoTurno.id_tratamiento=null,this.tratamientoSeleccionado={duracion:null,costo:null})}catch(e){console.error("Error al cargar tratamientos:",e.message),this.tratamientosDisponibles=[]}},actualizarDetallesTratamiento(t){const e=this.tratamientosDisponibles.find((e=>e.id_tratamiento===t));this.tratamientoSeleccionado=e?{duracion:e.duracion,costo:e.costo}:{duracion:null,costo:null}},guardarTurno(){this.isEdit?this.updateTurno(this.nuevoTurno):this.createTurno(this.nuevoTurno)},async createTurno(t){try{await r.A.post("/turnos",t);this.cargarTurnos(),this.dialog=!1}catch(e){const t=e.response?.data?.message||"Error al crear el turno.";this.$toast.error(t)}},async updateTurno(t){try{await r.A.put(`/turnos/${t.id_turno}`,t);this.cargarTurnos(),this.dialog=!1}catch(e){console.error("Error al actualizar el turno:",e);const t=e.response?.data?.message||"Error al actualizar el turno.";this.$toast.error(t)}},eliminarTurno(){this.nuevoTurno.id_turno&&r.A.delete(`/turnos/${this.nuevoTurno.id_turno}`).then((()=>{this.cargarTurnos(),this.dialog=!1})).catch((t=>{console.error("Error al eliminar el turno:",t),this.$toast.error("Error al eliminar el turno.")})),this.elimiarTurno=!1},onDateChange(t){this.picker=t,this.$forceUpdate()}},created(){this.fetchConsultoriosyTratamientos()},async mounted(){const t=localStorage.getItem("defaultView"),e=localStorage.getItem("weekday"),a=localStorage.getItem("selectedDate");this.value=a||(new Date).toISOString().split("T")[0],e&&(console.log("savedWeekday:",e),this.weekday=JSON.parse(e)),t&&(console.log("savedView:",t),this.type=t),"day"===this.type&&(this.type="category"),await this.fetchConsultoriosyTratamientos(),await this.cargarTurnos(),await this.cargarPacientes(),await this.getEvents(),this.updateCategories(),this.groupedEventsByDay(),this.$nextTick((()=>{if(this.$refs.calendar){this.value=this.$refs.calendar.value;const t=new Date(this.value);this.currentMonth=t.getUTCMonth(),this.currentYear=t.getUTCFullYear(),this.$forceUpdate()}}))},watch:{intervalMinutes(t){localStorage.setItem("intervalMinutes",t)},value(t){localStorage.setItem("selectedDate",t),this.updateCategories()},type(t){localStorage.setItem("defaultView",t),this.$nextTick((()=>{this.$refs.calendar&&(this.$refs.calendar.update(),this.$forceUpdate())}))},weekday(t){localStorage.setItem("weekday",JSON.stringify(t)),this.$nextTick((()=>{this.$refs.calendar&&(this.$refs.calendar.update(),this.$forceUpdate())}))},dialog(t){t||(this.nuevoTurno={id_paciente:null,fecha:"",hora:"",estado:"pendiente",id_consultorio_tratamiento:null})},turnos(){this.$nextTick((()=>{this.getEvents()}))}},computed:{calendarType(){return"list"===this.type?"month":(console.log(),"day"===this.type?"category":this.type)},groupedEventsByDay(){if(null===this.currentMonth||null===this.currentYear)return{};const t=this.events.reduce(((t,e)=>{const a=new Date(e.start+"Z"),o=a.getUTCMonth(),i=a.getUTCFullYear();if(o===this.currentMonth&&i===this.currentYear){const r=`${i}-${(o+1).toString().padStart(2,"0")}-${a.getUTCDate().toString().padStart(2,"0")}`;t[r]||(t[r]=[]),t[r].push(e)}return t}),{}),e={};return Object.keys(t).sort(((t,e)=>new Date(t)-new Date(e))).forEach((a=>{e[a]=t[a]})),e},horaFormateada(){return this.nuevoTurno.hora?this.nuevoTurno.hora:""},validarDatosTurno(){return!!this.nuevoTurno.id_paciente&&!!this.nuevoTurno.id_consultorio&&!!this.nuevoTurno.id_tratamiento&&!!this.nuevoTurno.fecha&&!!this.nuevoTurno.hora&&""!==this.nuevoTurno.fecha.trim()&&""!==this.nuevoTurno.hora.trim()},intervalCount(){return 15===this.intervalMinutes?64:30===this.intervalMinutes?32:45===this.intervalMinutes?24:60===this.intervalMinutes?16:32}}},s=n,l=a(81656),c=(0,l.A)(s,o,i,!1,null,"6c3ded47",null),u=c.exports}}]);
//# sourceMappingURL=324.6dc5a0c1.js.map